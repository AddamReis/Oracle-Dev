SELECT VIEW_NAME, TEXT FROM USER_VIEWS --RETORNA TODAS AS VIEWS CRIADAS

SELECT *FROM V_FUNCIONARIO --INFORMA O NOME DA VIEW NO SELECT

--VIEW SIMPLES
CREATE OR REPLACE VIEW V_FUNCIONARIO --VIEW APENAS PARA CONSULTA
AS
SELECT * FROM FUNCIONARIO F 
WHERE ID_CARGO = (SELECT C.ID_CARGO FROM CARGOEMPRESA C)
ORDER BY 1 DESC

CREATE OR REPLACE VIEW V_USERLOGIN (NOME, ULT_ACESSO, REGIAO, IDADE, SEXO) --TODOS ESTES DADOS SERÃO PARA RETORNO
AS
SELECT U.LOGIN AS NOME, A.ULT_ACESSO AS ULTIMO_ACESSO, R.ESTADO AS REGIAO, U.ANOS AS IDADE, S.SEXO AS SEXO
FROM USUARIO U
INNER JOIN ACESSOSISTEMA A ON U.ID_ID_ULT_ACESSO = U.ID_ULT_ACESSO
INNER JOIN REGIAOUF R ON U.ID_REGIAO = R.ID_REGIAO
INNER JOIN SEXUALIDADE S ON U.ID_SEXO = S.ID_SEXO
WHERE A.ULT_ACESSO >= To_Char('29/08/2019', 'DD,MM,YYYY')
ORDER BY 1 DESC
------------------------------------

--VIEW COMPLEXAS --UTILIZA GRUPOS DE FUNÇÕES
CREATE OR REPLACE VIEW V_SETOR
AS
SELECT 
To_Char(DATA, 'DD/MM/YYYY') DATA,
Max(Nvl(DESCONTO,0)) MAXIMO,
Avg(Nvl(DESCONTO, 0)) MEDIA,
Count(*) QTDE
FROM *TABELA*
GROUP BY To_Char(DATA, 'DD/MM/YYYY')
 
--OPERAÇÃO DML NA VIEW
--SÓ ADD SE ATENDER A CLAUSULA WHERE
CREATE OR REPLACE V_MAODEOBRA
AS
SELECT NOME, IDADE, ALTURA FROM *TABELA*
WHERE IDADE BETWEEN >=25 AND <=48 --SE ESTA CLAUSULA NÃO FOR ATENDIDA, NÃO SERÁ POSSÍVEL INSERIR OS DADOS NA TABELA 
WITH CHECK OPTION CONSTRAINT VMAODEOBRA

INSERT INTO V_MAODEOBRA (NOME, IDADE, ALTURA)
VALUES ('ELISABETH', 28, 1.70) --NESTE CASO, É POSSÍVEL INSERIR OS VALORES, POIS ATENDE A CLAUSULA WHERE DA VIEW V_MAODEOBRA

DELETE FROM V_MAODEOBRA WHERE ALTURA = 1.83--EXLUI APENAS O RESULTADO RETORNADO DA VIEW, NÃO EXCLUI OS DADOS DA TABELA

--OBS: NÃO É PERMITIDO FAZER DELETE(EXCLUIR OS PARAMETROS) DE UMA VIEW COMPLEXA (POSSUI FUNÇÕES DE GRUPO OU LIGAÇÃO COM OUTRAS TABELAS)
DELETE FROM V_MAODEOBRA --NÃO É EXECUTADO PORQUE É UMA VIEW COMPLEXA

--CLAUSULA READ ONLY(APENAS PARA LEITURA)
CREATE OR REPLACE VIEW V_ALUNO
AS
SELECT * 
FROM *TABELA*
WHERE SEXO = 'M'
WITH READ ONLY --CLAUSULA QUE TORNA A VIEW APENAS PARA LEITURA

DROP VIEW V_ALUNO --É POSSÍVEL EXCLUIR POIS A VIEW É SIMPLES E APENAS PARA LEITURA 
-------------------------------------
 
-------------------------------------
--OBS: É POSSÍVEL FAZER UM SELECT UTILIZANDO UMA VIEW EXISTENTE COMO PARAMETRO,
--EX:
SELECT U.NOME, U.IDADE, S.SEXO
FROM V_USUARIO U /*É UMA VIEW*/
WHERE U.ID_SEXO = S.ID_SEXO --FAZENDO REFERENCIA DO SEXO DA TABELA SEXO COM O ID DO SEXO EXISTENTE NA VIEW
